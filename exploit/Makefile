CC = gcc
CFLAGS_OSX = -lusb-1.0 -framework CoreFoundation -framework IOKit
CFLAGS_LNX =  -lusb-1.0

all:	
	arm-elf-gcc -mcpu=arm10tdmi -s -Ttext=0x8402f7a0 -nostdlib -o payload.o payload.S
	arm-elf-objcopy -O binary  payload.o payload.bin
	dd if=payload.bin of=exploit.dfu bs=1 seek=179200 conv=notrunc
	#arm-elf-gcc -mcpu=arm10tdmi -s -Ttext=0x8402f840 -nostdlib -o payload2.o payload2.S
	arm-elf-as -mthumb -o payload2.o payload2.S
	arm-elf-objcopy -O binary  payload2.o payload2.bin
	dd if=payload2.bin of=exploit.dfu bs=1 seek=179328 conv=notrunc
	#hexdump -C payload2.bin
	cp exploit.dfu ../staging/exploit.dfu
		
clean:
	rm payload.o
	rm payload.bin
	rm payload2.o
	rm payload2.bin