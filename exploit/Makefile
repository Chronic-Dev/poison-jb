DD = dd
AS = arm-elf-as
CC = arm-elf-gcc
OBJCOPY = arm-elf-objcopy
BIN2C = ../tools/bin2c
CFLAGS_OSX = -lusb-1.0 -framework CoreFoundation -framework IOKit
CFLAGS_LNX =  -lusb-1.0

all:	
	$(CC) -mcpu=arm10tdmi -s -Ttext=0x8402f7a0 -nostdlib -o payload.o payload.S
	$(AS) -mthumb -o payload2.o payload2.S
	$(OBJCOPY) -O binary  payload.o payload.bin
	$(OBJCOPY) -O binary  payload2.o payload2.bin
	$(DD) if=payload.bin of=exploit.dfu bs=1 seek=179200 conv=notrunc
	$(DD) if=payload2.bin of=exploit.dfu bs=1 seek=179328 conv=notrunc
	$(BIN2C) exploit.dfu ../injector/resources/exploit.h exploit
		
clean:
	rm -rf *.o *.bin