CC = gcc
AR = ar
CP = cp
ARMCC = arm-elf-gcc
ARMAS = arm-elf-as
OBJCOPY = arm-elf-objcopy
BIN2C = ../tools/bin2c
UNAME := $(shell uname -s)
BIN2C = ../../../tools/bin2c
CFLAGS_OSX = -lusb-1.0 -framework CoreFoundation -framework IOKit
CFLAGS_LNX =  -lusb-1.0
INCLUDE = -I./../..

all:	
	$(CP) shatter.dfu payload.bin
	$(ARMCC) -mcpu=arm10tdmi -s -Ttext=0x8402f7a0 -nostdlib -o payload1.o shatter1.S
	$(OBJCOPY) -O binary  payload1.o payload1.bin
	$(DD) if=payload1.bin of=payload.bin bs=1 seek=179200 conv=notrunc
	
	$(ARMAS) -mthumb -o payload2.o shatter2.S
	$(OBJCOPY) -O binary  payload2.o payload2.bin
	$(DD) if=payload2.bin of=payload.bin bs=1 seek=179328 conv=notrunc
	$(BIN2C) payload.bin payload.h shatter
	
	$(CC) -o shatter.o -c shatter.c $(INCLUDE) $(CFLAGS_LNX)
		
clean:
	rm -rf *.o *.bin payload.h
